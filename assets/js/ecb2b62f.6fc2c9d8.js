"use strict";(self.webpackChunk_docsearch_website=self.webpackChunk_docsearch_website||[]).push([[2587],{2227:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"run-your-own","title":"Run your own","description":"If you want to update your results with more control, or if you are not compliant with our checklist, or if your website sits behind a firewall, you might want to run the crawler yourself.","source":"@site/versioned_docs/version-legacy/run-your-own.md","sourceDirName":".","slug":"/run-your-own","permalink":"/docs/legacy/run-your-own","draft":false,"unlisted":false,"tags":[],"version":"legacy","frontMatter":{"title":"Run your own"},"sidebar":"docs","previous":{"title":"How do we build a DocSearch index?","permalink":"/docs/legacy/how-do-we-build-an-index"}}');var t=r(4848),i=r(8453);const s={title:"Run your own"},l=void 0,a={},c=[{value:"Set up your environment",id:"set-up-your-environment",level:2},{value:"Run the crawl from the Docker image",id:"run-the-crawl-from-the-docker-image",level:2},{value:"Running the crawler from the code base",id:"running-the-crawler-from-the-code-base",level:2},{value:"Installation",id:"installation",level:3},{value:"Installing Chrome driver",id:"installing-chrome-driver",level:3},{value:"Running the crawler",id:"running-the-crawler",level:3},{value:"Create a new configuration",id:"create-a-new-configuration",level:2},{value:"Testing your results",id:"testing-your-results",level:2},{value:"Integration",id:"integration",level:2},{value:"Help",id:"help",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["If you want to update your results with more control, or if you are ",(0,t.jsx)(n.a,{href:"/docs/who-can-apply",children:"not compliant with our checklist"}),", or if your website sits behind a firewall, you might want to run the crawler yourself."]}),"\n",(0,t.jsx)(n.p,{children:"The whole code base of DocSearch is open source, and we package it as a Docker image to make this even easier for you to use."}),"\n",(0,t.jsx)(n.h2,{id:"set-up-your-environment",children:"Set up your environment"}),"\n",(0,t.jsxs)(n.p,{children:["You'll need to set your Algolia application ID and admin API key as environment variables. If you don't have an Algolia account, you need to ",(0,t.jsx)(n.a,{href:"https://www.algolia.com/pricing",children:"create one"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"APPLICATION_ID"})," set to your Algolia Application ID"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"API_KEY"})," set to your API Key. Make sure to use an API key with ",(0,t.jsx)(n.strong,{children:"write"})," access to your index. It needs ",(0,t.jsxs)(n.a,{href:"https://www.algolia.com/doc/guides/security/api-keys/#acl",children:["the ACL ",(0,t.jsx)(n.code,{children:"addObject"}),", ",(0,t.jsx)(n.code,{children:"editSettings"})," and ",(0,t.jsx)(n.code,{children:"deleteIndex"})]}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For convenience, you can create a ",(0,t.jsx)(n.code,{children:".env"})," file in the repository root."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"APPLICATION_ID=YOUR_APP_ID\nAPI_KEY=YOUR_API_KEY\n"})}),"\n",(0,t.jsx)(n.h2,{id:"run-the-crawl-from-the-docker-image",children:"Run the crawl from the Docker image"}),"\n",(0,t.jsxs)(n.p,{children:["You can run a crawl from the packaged Docker image to crawl your website. You will need to ",(0,t.jsx)(n.a,{href:"https://github.com/stedolan/jq/wiki/Installation",children:"install jq, a lightweight command-line JSON processor"})]}),"\n",(0,t.jsxs)(n.p,{children:["Then you need to start the crawl according to your configuration. You should check the ",(0,t.jsx)(n.a,{href:"/docs/legacy/config-file",children:"dedicated configuration documentation"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'docker run -it --env-file=.env -e "CONFIG=$(cat /path/to/your/config.json | jq -r tostring)" algolia/docsearch-scraper\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Once the scraping finishes, you can ",(0,t.jsx)(n.a,{href:"#integration",children:"jump to the Integration step"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"running-the-crawler-from-the-code-base",children:"Running the crawler from the code base"}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(n.p,{children:["The scraper is a python tool ",(0,t.jsx)(n.a,{href:"https://scrapy.org/",children:"based on scrapy"}),". We do recommend to use ",(0,t.jsx)(n.a,{href:"https://github.com/pypa/pipenv",children:"pipenv"})," to install the python environment."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/algolia/docsearch-scraper",children:"Clone the scraper repository"}),"."]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://pipenv.readthedocs.io/en/latest/install/#installing-pipenv",children:"Install pipenv"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pipenv install"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pipenv shell"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If you plan to use the browser emulation ",(0,t.jsxs)(n.a,{href:"/docs/legacy/config-file",children:["(",(0,t.jsx)(n.code,{children:"js_render"})," set to true)"]}),", you need to follow this extra step. If you don't, you can dismiss this step."]}),"\n",(0,t.jsx)(n.h3,{id:"installing-chrome-driver",children:"Installing Chrome driver"}),"\n",(0,t.jsx)(n.p,{children:"Some websites rendering requires JavaScript. Our crawler relies on a headless chrome emulation. You will need to set up a ChromeDriver."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"http://chromedriver.chromium.org/getting-started",children:"Install the driver"})," suited to your OS and the version of your Chrome. We do recommend to use the latest version."]}),"\n",(0,t.jsxs)(n.li,{children:["Set the environment variable ",(0,t.jsx)(n.code,{children:"CHROMEDRIVER_PATH"})," in your ",(0,t.jsx)(n.code,{children:".env"})," file. This path must target the downloaded extracted driver."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You are ready to go."}),"\n",(0,t.jsx)(n.h3,{id:"running-the-crawler",children:"Running the crawler"}),"\n",(0,t.jsxs)(n.p,{children:["Running ",(0,t.jsx)(n.code,{children:"pipenv shell"})," will enable your virtual environment. From there, you can run one crawl with the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"$ ./docsearch run /path/to/your/config.json\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or from the Docker image:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"$ ./docsearch docker:run /path/to/your/config.json\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will start the crawl. It extracts content from parsed pages and push the built records to Algolia."}),"\n",(0,t.jsx)(n.h2,{id:"create-a-new-configuration",children:"Create a new configuration"}),"\n",(0,t.jsxs)(n.p,{children:["To create a configuration, run ",(0,t.jsx)(n.code,{children:"./docsearch bootstrap"}),". A prompt will ask you for some information and will create a JSON configuration you can use as a base."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'$ ./docsearch bootstrap\n# Enter your documentation url\nstart url: http://www.example.com/docs/\n# Pick another name, or press enter\nindex_name is example [enter to confirm]: <Enter>\n\n=================\n{\n  "index_name": "example",\n  "start_urls": [\n    "http://www.example.com/docs/"\n  ],\n  "stop_urls": [],\n  "selectors": {\n    "lvl0": "FIXME h1",\n    "lvl1": "FIXME h2",\n    "lvl2": "FIXME h3",\n    "lvl3": "FIXME h4",\n    "lvl4": "FIXME h5",\n    "lvl5": "FIXME h6",\n    "text": "FIXME p, FIXME li"\n  }\n}\n=================\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Create a file from this text into a filename ",(0,t.jsx)(n.code,{children:"example.json"}),", we'll use it later on to start the crawl. You can browse the ",(0,t.jsx)(n.a,{href:"https://github.com/algolia/docsearch-configs/tree/master/configs",children:"list of live configurations"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"testing-your-results",children:"Testing your results"}),"\n",(0,t.jsxs)(n.p,{children:["You can test your results by running ",(0,t.jsx)(n.code,{children:"./docsearch playground"}),". This will open a web page with a search input. You can do live tests against the indexed results."]}),"\n",(0,t.jsx)("img",{src:"https://docsearch.algolia.com/img/assets/playground.png",alt:"Playground"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["Note that if the command fails (it can happen on non-Mac machines), you can get the same result by running a live server in the ",(0,t.jsx)(n.code,{children:"./playground"})," subdirectory.`"]})}),"\n",(0,t.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,t.jsxs)(n.p,{children:["Once you're satisfied with your config, you can integrate the dropdown menu in your website by following the ",(0,t.jsx)(n.a,{href:"/docs/legacy/dropdown",children:"instructions here"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The difference is that you'll also have to add the ",(0,t.jsx)(n.code,{children:"appId"})," key to your ",(0,t.jsx)(n.code,{children:"docsearch()"})," instance. Also don't forget to use a ",(0,t.jsx)(n.strong,{children:"search"})," API key here (in other words, not the ",(0,t.jsx)(n.strong,{children:"write"})," API key you used for the crawl)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"docsearch({\n  appId: '<APP_ID>', // Add your own Application ID\n  apiKey: '<API_KEY>', // Set it to your own *search* API key\n  [\u2026] // Other parameters are the same\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"help",children:"Help"}),"\n",(0,t.jsxs)(n.p,{children:["You can run ",(0,t.jsx)(n.code,{children:"./docsearch"})," without any argument to see the list of all available commands."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Note that we use this command-line tool internally at Algolia to run the free hosted version, so you might not need all the listed commands."})})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var o=r(6540);const t={},i=o.createContext(t);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);